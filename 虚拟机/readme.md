# 计算机组成原理作业

## 虚拟机（第一版）使用教程

---

### 目录
<!-- TOC -->
>[1.文件简述](#1.文件简述)
>
>[2.实现功能](#2.实现功能)
>
>[3.使用流程](#3.使用流程)
>
>[4.程序异常及其提示](#4.程序异常及其提示)
<!-- /TOC -->

---

### 1.文件简述

打开文件夹，可以看到如下四个文件：

>计组作业.exe&ensp;计组作业.py&ensp;log.txt&ensp;test.txt

**计组作业.exe**：&ensp;可执行文件，可以直接运行

**计组作业.py**：&ensp;Python文件源代码

**log.txt**：&ensp;程序运行日志，可以在文件中查看控制台输出，解决控制台输出难以记录的问题

**test.txt**：&ensp;指令输入文件，要输入的指令将存放在这里

---

### 2.实现功能

- 准确显示每一条指令实现的过程，指示了取指周期和执行周期

- 现版本能够执行以下6种命令

```armasm
CLA ADD STA JMP NOP STOP
```

- 其中，*STOP*指令能够起到断点的作用，使本程序进入单步调试模式，在单步调试中，您可以看到完整的内存和寄存器情况，详情请见[使用流程](#3.使用流程)

- 具有基本的错误处理和防死循环功能，详情请见[程序异常以及其它提示](#4.程序异常及其提示)

- 具有能够以文本的方式记录控制台全部输出的运行日志

---

### 3.使用流程

- **将汇编指令输入 test.txt文件**，文件格式要求为`汇编指令 地址`。  
   其中，汇编指令大小写不敏感，地址必须使用整数且建议数字较小，方便调试时查看内存。  
   请注意，指令和地址二者必须用**空格**分格！  
   以下是一段测试样例：

```armasm
CLA
ADD 12
NOP
STOP
STA 15
JMP 9





06
```

- **运行 计组作业.exe文件**，此时要求输入两个参数  
  >请输入指令起始PC地址:
  >
  >请输入内存总大小（请根据指令的范围选择稍大的内存！）:

  第一个参数为一个正整数，即选择在整块内存中要将第一行指令放在哪个位置，建议根据汇编指令酌情选择数值较小的起始PC地址  
  第二个参数为一个正整数，选择整块内存的大小，建议至少要大于任何汇编指令文件中的指令所在或所指向的最大位置。但是不建议过大，以免运行过慢且难以查看。例如对上方的汇编指令样例，建议内存大小为20

- **程序运行时**，将会在控制台给出简短的执行情况报告。如果要进行调试，请自行修改指令，在**test.txt**中将`STOP`命令插入想要设置的断点的上一行并运行**计组作业.exe**文件，关于调试模式的使用请看[下一条说明](#jump1)。如果认为控制台的信息显示过快难以记录，请看关于[程序结束的说明](#jump2)

- <span id="jump1"></span> **在调试模式中**，您可以看到全部内存以及主要寄存器的情况。在看到以下内容时，您可以根据提示，输入除了q以外的任何字符以继续（注意，不输入任何字符而直接回车也能够继续执行单步调试，但是将没有输入字符提示）。  
  
  >输入q键并按回车键退出，输入其它按键并按回车键继续：
  
  而输入q字符并回车后，将回到正常模式。其中，输入的q字符大小写不敏感。

- <span id="jump2"></span>**程序结束后**，控制台将会显示此时全部内存的情况。您可以打开**log.txt**文件，该文件附有程序执行时控制台显示的全部内容以及时间戳。请注意，每次执行本程序将会清空**log.txt**文件的内容。

---

### 4.程序异常及其提示

- **死循环** 在执行`JMP`指令时，有可能因为该指令的目标地址选择错误跳转到PC会重复指向的地址进而发生死循环。本程序在检测到同一个`JMP`指令重复循环执行10次时，将会强制退出。请检查`JMP`指令跳转的目标地址

- **指令文本（test.txt）第X行不是一个指令** 通常，该指令表示所有PC可访问的合法指令都执行完毕。但在某些时候，这条命令表示PC指向的指令不是由纯英文指令组成的合法指令，此时请根据提示修改指令文本并重新运行。

- **无法处理第X行命令** 这表明本程序无法运行该行指令，请检查该行指令是否受到[本程序支持](#2.实现功能)，并检查拼写是否有误。
